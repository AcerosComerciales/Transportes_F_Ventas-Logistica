Imports System
Imports System.Data
Imports System.Data.Common
Imports System.Collections.Generic

Imports ACFramework
Imports DAConexion
Imports ACETransporte

Partial Public Class DTRAN_Fletes

#Region " Constructores "
	
#End Region

#Region " Procedimientos Almacenados "
   Public Function FLETSS_TodosDisponibles(ByRef dtETRAN_Fletes As DataTable) As Boolean
      Try
         DAEnterprise.AsignarProcedure(getSelectAllDisponibles(), CommandType.Text)
         dtETRAN_Fletes = DAEnterprise.ExecuteDataSet().Tables(0)
         Return dtETRAN_Fletes.Rows.Count > 0
      Catch ex As Exception
         Throw ex
      End Try
   End Function

   ''' <summary> 
   ''' Procedimiento "TRAN_FLETESS_UnReg" por el Generador 27/02/2012
   ''' </summary> 
   ''' <param name="m_listTRAN_Fletes">Lista donde se cargaran los valores</param> 
   ''' <param name="x_entid_codigo">Parametro 1: </param> 
   ''' <returns>Si no hay registros devuelve Falso</returns> 
   ''' <remarks></remarks> 
   Public Function TRAN_FLETESS_UnReg(ByRef m_listTRAN_Fletes As List(Of ETRAN_Fletes), ByVal x_entid_codigo As String) As Boolean
      Try
         DAEnterprise.AsignarProcedure("TRAN_FLETESS_UnReg")
         DAEnterprise.AgregarParametro("@ENTID_Codigo", x_entid_codigo, DbType.String, 14)
         Using reader As DbDataReader = DAEnterprise.ExecuteDataReader()
            If reader.HasRows Then
               While reader.Read()
                  Dim e_tran_fletes As New ETRAN_Fletes()
                  ACEsquemas.ACCargarEsquema(reader, e_TRAN_Fletes)
                  e_TRAN_Fletes.Instanciar(ACEInstancia.Consulta)
                  m_listTRAN_Fletes.Add(e_TRAN_Fletes)
               End While
               Return True
            Else
               Return False
            End If
         End Using
         Return True
      Catch ex As Exception
         Throw ex
      End Try
   End Function

   ''' <summary> 
   ''' Capa de Datos: TRAN_CAJASS_PendienteFletes
   ''' </summary>
   ''' <param name="x_fecfin">Parametro 1: </param> 
   ''' <returns></returns> 
   ''' <remarks></remarks> 
   Public Function TRAN_CAJASS_PendienteFletes(ByVal m_listtran_fletes As List(Of ETRAN_Fletes), ByVal x_fecini As Date, ByVal x_fecfin As Date) As Boolean
      Try
         DAEnterprise.AsignarProcedure("TRAN_CAJASS_PendienteFletes")
         DAEnterprise.AgregarParametro("@FecIni", x_fecini, DbType.DateTime, 8)
         DAEnterprise.AgregarParametro("@FecFin", x_fecfin, DbType.DateTime, 8)
         Using reader As DbDataReader = DAEnterprise.ExecuteDataReader()
            If reader.HasRows Then
               While reader.Read()
                  Dim _tran_fletes As New ETRAN_Fletes()
                  ACEsquemas.ACCargarEsquema(reader, _tran_fletes)
                  _tran_fletes.Instanciar(ACEInstancia.Consulta)
                  m_listtran_fletes.Add(_tran_fletes)
               End While
               Return True
            Else
               Return False
            End If
         End Using
         Return True
      Catch ex As Exception
         Throw ex
      End Try
   End Function

   ''' <summary> 
   ''' Procedimiento "TRAN_FLETESS_Ayuda" por el Generador 20/03/2012
   ''' </summary> 
   ''' <param name="m_listTRAN_Fletes">Lista donde se cargaran los valores</param> 
   ''' <param name="x_cadena">Parametro 1: </param> 
   ''' <param name="x_opcion">Parametro 2: </param> 
   ''' <param name="x_fecini">Parametro 3: </param> 
   ''' <param name="x_fecfin">Parametro 4: </param> 
   ''' <returns>Si no hay registros devuelve Falso</returns> 
   ''' <remarks></remarks> 
   Public Function TRAN_FLETESS_Ayuda(ByRef m_listTRAN_Fletes As List(Of ETRAN_Fletes), ByVal x_cadena As String, ByVal x_opcion As Short, ByVal x_fecini As Date, ByVal x_fecfin As Date) As Boolean
      Try
         DAEnterprise.AsignarProcedure("TRAN_FLETESS_Ayuda")
         DAEnterprise.AgregarParametro("@Cadena", x_cadena, DbType.String, 80)
         DAEnterprise.AgregarParametro("@Opcion", x_opcion, DbType.Int16, 2)
         DAEnterprise.AgregarParametro("@FecIni", x_fecini, DbType.DateTime, 8)
         DAEnterprise.AgregarParametro("@FecFin", x_fecfin, DbType.DateTime, 8)
         Using reader As DbDataReader = DAEnterprise.ExecuteDataReader()
            If reader.HasRows Then
               While reader.Read()
                  Dim e_tran_fletes As New ETRAN_Fletes()
                  ACEsquemas.ACCargarEsquema(reader, e_TRAN_Fletes)
                  e_TRAN_Fletes.Instanciar(ACEInstancia.Consulta)
                  m_listTRAN_Fletes.Add(e_TRAN_Fletes)
               End While
               Return True
            Else
               Return False
            End If
         End Using
         Return True
      Catch ex As Exception
         Throw ex
      End Try
   End Function

   ''' <summary> 
   ''' Capa de Datos: TRAN_FLETESS_ConsultaFletes
   ''' </summary>
   ''' <param name="x_cadena">Parametro 1: </param> 
   ''' <param name="x_opcion">Parametro 2: </param> 
   ''' <param name="x_opfecha">Parametro 3: </param> 
   ''' <param name="x_fecini">Parametro 4: </param> 
   ''' <param name="x_fecfin">Parametro 5: </param> 
   ''' <returns></returns> 
   ''' <remarks></remarks> 
   Public Function TRAN_FLETESS_ConsultaFletes(ByVal m_listtran_fletes As List(Of ETRAN_Fletes), ByVal x_cadena As String, ByVal x_opcion As Short, ByVal x_opfecha As Short, ByVal x_fecini As Date, ByVal x_fecfin As Date) As Boolean
      Try
         DAEnterprise.AsignarProcedure("TRAN_FLETESS_ConsultaFletes")
         DAEnterprise.AgregarParametro("@Cadena", x_cadena, DbType.String, 50)
         DAEnterprise.AgregarParametro("@Opcion", x_opcion, DbType.Int16, 2)
         DAEnterprise.AgregarParametro("@OpFecha", x_opfecha, DbType.Int16, 2)
         DAEnterprise.AgregarParametro("@FecIni", x_fecini, DbType.DateTime, 8)
         DAEnterprise.AgregarParametro("@FecFin", x_fecfin, DbType.DateTime, 8)
         Using reader As DbDataReader = DAEnterprise.ExecuteDataReader()
            If reader.HasRows Then
               While reader.Read()
                  Dim _tran_fletes As New ETRAN_Fletes()
                  ACEsquemas.ACCargarEsquema(reader, _tran_fletes)
                  _tran_fletes.Instanciar(ACEInstancia.Consulta)
                  m_listtran_fletes.Add(_tran_fletes)
               End While
               Return True
            Else
               Return False
            End If
         End Using
         Return True
      Catch ex As Exception
         Throw ex
      End Try
   End Function

   ''' <summary> 
   ''' Capa de Datos: TRAN_FLETESS_ConsultaFletesDoc
   ''' </summary>
   ''' <param name="x_tipos_codtipodocumento">Parametro 1: </param> 
   ''' <param name="x_docve_serie">Parametro 2: </param> 
   ''' <param name="x_docve_numero">Parametro 3: </param> 
   ''' <returns></returns> 
   ''' <remarks></remarks> 
   Public Function TRAN_FLETESS_ConsultaFletesDoc(ByVal m_listtran_fletes As List(Of ETRAN_Fletes), ByVal x_tipos_codtipodocumento As String, ByVal x_docve_serie As String, ByVal x_docve_numero As String) As Boolean
      Try
         DAEnterprise.AsignarProcedure("TRAN_FLETESS_ConsultaFletesDoc")
         DAEnterprise.AgregarParametro("@TIPOS_CodTipoDocumento", x_tipos_codtipodocumento, DbType.String, 6)
         DAEnterprise.AgregarParametro("@DOCVE_Serie", x_docve_serie, DbType.String, 3)
         DAEnterprise.AgregarParametro("@DOCVE_Numero", x_docve_numero, DbType.String, 7)
         Using reader As DbDataReader = DAEnterprise.ExecuteDataReader()
            If reader.HasRows Then
               While reader.Read()
                  Dim _tran_fletes As New ETRAN_Fletes()
                  ACEsquemas.ACCargarEsquema(reader, _tran_fletes)
                  _tran_fletes.Instanciar(ACEInstancia.Consulta)
                  m_listtran_fletes.Add(_tran_fletes)
               End While
               Return True
            Else
               Return False
            End If
         End Using
         Return True
      Catch ex As Exception
         Throw ex
      End Try
   End Function

#Region "Procedimientos Adicionales "
   Public Function getSelectAllDisponibles() As String
      Dim sql As String = ""
      Try
         sql = " SELECT "
         sql &= " Right(Flet.FLETE_Codigo, 8) As Codigo" & vbNewLine
         sql &= ",TMPag.TIPOS_Descripcion As [Modo Pago] " & vbNewLine
         sql &= ",Ruta.RUTAS_Nombre As [Ruta]" & vbNewLine
         sql &= ",FLETE_FECPROGRAMADA As [Fec. Programada]" & vbNewLine
         sql &= ",FLETE_FECSALIDA As [Fec. Salida]" & vbNewLine
         sql &= ",FLETE_FECLLEGADA As [Fec. Llegada]" & vbNewLine
         sql &= ",FLETE_TOTGASTO As [Gastos]" & vbNewLine
         sql &= ",Flet.FLETE_Id As Interno" & vbNewLine
         sql &= " FROM Transportes.TRAN_Fletes As Flet" & vbNewLine
         sql &= " Inner Join Tipos As TMPag On TMPag.TIPOS_Codigo = Flet.TIPOS_CodModoPago" & vbNewLine
         sql &= " Inner Join Transportes.TRAN_Rutas As Ruta On Ruta.RUTAS_Id = Flet.RUTAS_Id" & vbNewLine
         sql &= " Where Flet.VIAJE_Id Is Null" & vbNewLine
         Return sql
      Catch ex As Exception
         Throw ex
      End Try
   End Function
#End Region
#End Region

End Class

