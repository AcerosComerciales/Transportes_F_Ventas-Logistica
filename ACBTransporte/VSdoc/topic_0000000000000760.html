<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="GENERATOR" content="VSdocman - documentation generator; http://www.helixoft.com" />
	<title>BGCancelacion.GrabarPagos (Método)</title>

	<link rel="stylesheet" type="text/css" href="msdn10_lightweight/msdn10_lightweight.css"></link>
	<script src="msdn10_lightweight/msdn10_lightweight.js" type="text/javascript"></script>
	<script src="SyntaxHighlighter/scripts/shCore_helixoft.js" type="text/javascript"></script>
	<script src="SyntaxHighlighter/scripts/shBrushVb.js" type="text/javascript"></script>
	<script src="SyntaxHighlighter/scripts/shBrushCSharp.js" type="text/javascript"></script>
	<script src="SyntaxHighlighter/scripts/shBrushCpp.js" type="text/javascript"></script>
	<script src="SyntaxHighlighter/scripts/shBrushJScript.js" type="text/javascript"></script>
	<link href="SyntaxHighlighter/styles/shCore.css" rel="stylesheet" type="text/css" />
	<link href="SyntaxHighlighter/styles/shThemeMsdnLW.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript">
		SyntaxHighlighter.all();
	</script>				

	<script type="text/javascript">
<!--
if (self.name != "vbdocright") {
	if (location.search != "?toc=no") {
		var filename = location.pathname.replace(/\\/g, "/");
		filename = filename.substring(filename.lastIndexOf('/')+1);
		location.replace("index.html#" + filename);
	} 
}

function replaceTitleAndUrl(win, title, url) {
	if(history.replaceState) {
		win.history.replaceState(null, title, url);
	} else {
		win.document.title = document.title;
		win.location.replace(url);
	}
}
//-->
	</script>	
</head>

<body style="direction: ltr;">
	<script type="text/javascript">
		try {
			if (location.search != "?toc=no") {
				parent.document.title = document.title;
				var filename = location.pathname.replace(/\\/g, "/");
				filename = filename.substring(filename.lastIndexOf('/')+1);
				if (window.parent.location.search == null || window.parent.location.search != "?" + filename) {
					if (window.parent.location.hash == null || window.parent.location.hash != "#" + filename) {
						replaceTitleAndUrl(window.parent, document.title, "index.html#" + filename);
					}
				}
			}
		} catch (ex) {}
	</script>
	<div id="topic">
<!--HEADER START-->
  <div id="header">
  	<div id="runningHeaderText">ACBTransporte Reference</div>
  	<h1 class="title">BGCancelacion.GrabarPagos (Método)</h1>
  	<div id="headerLinks">

	<a href="#seeAlsoSection">Vea también</a>

		</div>
		<hr />
	</div>
<!--HEADER END-->
    
		<div id="mainSection">
      <div id="mainBody">
        <p />
       



        <br /><strong>Ensamblado:</strong> ACBTransporte (in ACBTransporte.dll)











<div class="section_container">
	<div class="section_heading">
		<span><a href="javascript:void(0)" title="Collapse" onclick="toggleSection(this);">Sintaxis</a></span>
		<div><hr /></div>
	</div>

	<div id="syntaxSection" class="section">	
	
	
	<div id="syntaxCodeBlocks">
		<div class="codeSnippetContainer">		
			<div class="codeSnippetTabs">
				<div class="codeSnippetTabLeftCornerActive">
				</div>
				<div class="codeSnippetTab csFirstTab csActiveTab codeVB">
					<a>VB</a>
				</div>
				<div class="codeSnippetTab csNaTab codeCsharp">
					<a href="javascript: CodeSnippet_SetLanguage('Csharp');">C#</a>
				</div>
				<div class="codeSnippetTab csNaTab codeCpp">
					<a href="javascript: CodeSnippet_SetLanguage('Cpp');">C++</a>
				</div>
				<div class="codeSnippetTab csLastTab csNaTab codeJScript">
					<a href="javascript: CodeSnippet_SetLanguage('JScript');">JScript</a>
				</div>
				<div class="codeSnippetTabRightCorner">
				</div>
				<div style="clear:both;">
				</div>
			</div>
	
			<div class="codeSnippetCodeCollection">
				<div class="codeSnippetToolbar">
					<a title="Copy to clipboard." href="javascript:void(0)" onclick="CopyCode(this);">Copy</a>
				</div>
				
				<div class="codeSnippetCode codeVB">
					<pre xml:space="preserve" class="brush: vb">Public Function GrabarPagos( _&nbsp;<br />   ByVal <i>x_usuario</i> As <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.string.aspx">String</a>, _&nbsp;<br />   ByVal <i>m_tipopago</i> As <strong>TipoDePago</strong>, _&nbsp;<br />   ByVal <i>x_serie</i> As <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.string.aspx">String</a>, _&nbsp;<br />   ByVal <i>x_fecha</i> As <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.datetime.aspx">Date</a>, _&nbsp;<br />   ByVal <i>x_tipocambio</i> As <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.decimal.aspx">Decimal</a> _&nbsp;<br />) As <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.object.aspx">Object</a></pre>			
				</div>
				<div class="codeSnippetCode codeNA">
					<pre xml:space="preserve">Este idioma no es compatible o no hay ningún ejemplo de código disponible.</pre>			
				</div>
			</div>
		</div>
		
		<div class="codeSnippetContainer">
			<div class="codeSnippetTabs">
				<div class="codeSnippetTabLeftCorner">
				</div>
				<div class="codeSnippetTab csFirstTab csNaTab codeVB">
					<a>VB</a>
				</div>
				<div class="codeSnippetTab csActiveTab codeCsharp">
					<a href="javascript: CodeSnippet_SetLanguage('Csharp');">C#</a>
				</div>
				<div class="codeSnippetTab csNaTab codeCpp">
					<a href="javascript: CodeSnippet_SetLanguage('Cpp');">C++</a>
				</div>
				<div class="codeSnippetTab csLastTab csNaTab codeJScript">
					<a href="javascript: CodeSnippet_SetLanguage('JScript');">JScript</a>
				</div>
				<div class="codeSnippetTabRightCorner">
				</div>
				<div style="clear:both;">
				</div>
			</div>
	
			<div class="codeSnippetCodeCollection">
				<div class="codeSnippetToolbar">
					<a title="Copy to clipboard." href="javascript:void(0)" onclick="CopyCode(this);">Copy</a>
				</div>
				
				<div class="codeSnippetCode codeCsharp">
					<pre xml:space="preserve" class="brush: csharp">public <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.object.aspx">object</a> GrabarPagos(&nbsp;<br />   <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.string.aspx">string</a> <i>x_usuario</i>,&nbsp;<br />   <strong>TipoDePago</strong> <i>m_tipopago</i>,&nbsp;<br />   <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.string.aspx">string</a> <i>x_serie</i>,&nbsp;<br />   <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.datetime.aspx">DateTime</a> <i>x_fecha</i>,&nbsp;<br />   <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.decimal.aspx">decimal</a> <i>x_tipocambio</i>&nbsp;<br />)</pre>			
				</div>
				<div class="codeSnippetCode codeNA">
					<pre xml:space="preserve">Este idioma no es compatible o no hay ningún ejemplo de código disponible.</pre>			
				</div>
			</div>
		</div>

		<div class="codeSnippetContainer">
			<div class="codeSnippetTabs">
				<div class="codeSnippetTabLeftCorner">
				</div>
				<div class="codeSnippetTab csFirstTab csNaTab codeVB">
					<a>VB</a>
				</div>
				<div class="codeSnippetTab csNaTab codeCsharp">
					<a href="javascript: CodeSnippet_SetLanguage('Csharp');">C#</a>
				</div>
				<div class="codeSnippetTab csActiveTab codeCpp">
					<a href="javascript: CodeSnippet_SetLanguage('Cpp');">C++</a>
				</div>
				<div class="codeSnippetTab csLastTab csNaTab codeJScript">
					<a href="javascript: CodeSnippet_SetLanguage('JScript');">JScript</a>
				</div>
				<div class="codeSnippetTabRightCorner">
				</div>
				<div style="clear:both;">
				</div>
			</div>
	
			<div class="codeSnippetCodeCollection">
				<div class="codeSnippetToolbar">
					<a title="Copy to clipboard." href="javascript:void(0)" onclick="CopyCode(this);">Copy</a>
				</div>
				
				<div class="codeSnippetCode codeCpp">
					<pre xml:space="preserve" class="brush: cpp">public: &nbsp;<br /><a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.object.aspx">object</a>^ GrabarPagos(&nbsp;<br />   <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.string.aspx">String</a>^ <i>x_usuario</i>,&nbsp;<br />   <strong>TipoDePago</strong> <i>m_tipopago</i>,&nbsp;<br />   <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.string.aspx">String</a>^ <i>x_serie</i>,&nbsp;<br />   <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.datetime.aspx">DateTime</a> <i>x_fecha</i>,&nbsp;<br />   <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.decimal.aspx">Decimal</a> <i>x_tipocambio</i>&nbsp;<br />) </pre>			
				</div>
				<div class="codeSnippetCode codeNA">
					<pre xml:space="preserve">Este idioma no es compatible o no hay ningún ejemplo de código disponible.</pre>			
				</div>
			</div>
		</div>
		
		<div class="codeSnippetContainer">
			<div class="codeSnippetTabs">
				<div class="codeSnippetTabLeftCorner">
				</div>
				<div class="codeSnippetTab csFirstTab csNaTab codeVB">
					<a>VB</a>
				</div>
				<div class="codeSnippetTab csNaTab codeCsharp">
					<a href="javascript: CodeSnippet_SetLanguage('Csharp');">C#</a>
				</div>
				<div class="codeSnippetTab csNaTab codeCpp">
					<a href="javascript: CodeSnippet_SetLanguage('Cpp');">C++</a>
				</div>
				<div class="codeSnippetTab csActiveTab csLastTab codeJScript">
					<a href="javascript: CodeSnippet_SetLanguage('JScript');">JScript</a>
				</div>
				<div class="codeSnippetTabRightCornerActive">
				</div>
				<div style="clear:both;">
				</div>
			</div>
	
			<div class="codeSnippetCodeCollection">
				<div class="codeSnippetToolbar">
					<a title="Copy to clipboard." href="javascript:void(0)" onclick="CopyCode(this);">Copy</a>
				</div>
				
				<div class="codeSnippetCode codeJScript">
					<pre xml:space="preserve" class="brush: js">public function GrabarPagos(&nbsp;<br />    <i>x_usuario</i> : <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.string.aspx">String</a>,&nbsp;<br />    <i>m_tipopago</i> : <strong>TipoDePago</strong>,&nbsp;<br />    <i>x_serie</i> : <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.string.aspx">String</a>,&nbsp;<br />    <i>x_fecha</i> : <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.datetime.aspx">DateTime</a>,&nbsp;<br />    <i>x_tipocambio</i> : <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.decimal.aspx">decimal</a>&nbsp;<br />) : <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.object.aspx">object</a>;</pre>			
				</div>
				<div class="codeSnippetCode codeNA">
					<pre xml:space="preserve">Este idioma no es compatible o no hay ningún ejemplo de código disponible.</pre>			
				</div>
			</div>
		</div>
		
	</div>


<h4 class="subHeading">
	Parámetros</h4><dl paramName="x_usuario">
	<dt>
		<span class="parameter">
			x_usuario
		</span>
	</dt>
	<dd>
		<p>
			Tipo: <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.string.aspx">string</a> 
		</p>
		<p>
			 
		</p>
	</dd>
</dl>
<dl paramName="m_tipopago">
	<dt>
		<span class="parameter">
			m_tipopago
		</span>
	</dt>
	<dd>
		<p>
			Tipo: <strong>TipoDePago</strong> 
		</p>
		<p>
			 
		</p>
	</dd>
</dl>
<dl paramName="x_serie">
	<dt>
		<span class="parameter">
			x_serie
		</span>
	</dt>
	<dd>
		<p>
			Tipo: <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.string.aspx">string</a> 
		</p>
		<p>
			 
		</p>
	</dd>
</dl>
<dl paramName="x_fecha">
	<dt>
		<span class="parameter">
			x_fecha
		</span>
	</dt>
	<dd>
		<p>
			Tipo: <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.datetime.aspx">DateTime</a> 
		</p>
		<p>
			 
		</p>
	</dd>
</dl>
<dl paramName="x_tipocambio">
	<dt>
		<span class="parameter">
			x_tipocambio
		</span>
	</dt>
	<dd>
		<p>
			Tipo: <a target="_top" href="http://msdn2.microsoft.com/en-us/library/system.decimal.aspx">decimal</a> 
		</p>
		<p>
			 
		</p>
	</dd>
</dl>

<p />
<p />














	</div>
</div>





















<div class="section_container">
	<div class="section_heading">
		<span><a href="javascript:void(0)" title="Collapse" onclick="toggleSection(this);">Código fuente</a></span>
		<div><hr /></div>
	</div>

	<div id="sourceCodeSection" class="section">	
		<div class="codeSnippetContainer">		
			<div class="codeSnippetTabs">
				<div class="codeSnippetTabLeftCornerActive">
				</div>
				<div class="codeSnippetTab csFirstTab csActiveTab codeVB">
					<a>VB</a>
				</div>
				<div class="codeSnippetTab csNaTab codeCsharp">
					<a href="javascript: CodeSnippet_SetLanguage('Csharp');">C#</a>
				</div>
				<div class="codeSnippetTab csNaTab codeCpp">
					<a href="javascript: CodeSnippet_SetLanguage('Cpp');">C++</a>
				</div>
				<div class="codeSnippetTab csNaTab csLastTab codeJScript">
					<a href="javascript: CodeSnippet_SetLanguage('JScript');">JScript</a>
				</div>
				<div class="codeSnippetTabRightCorner">
				</div>
				<div style="clear:both;">
				</div>
			</div>
	
			<div class="codeSnippetCodeCollection">
				<div class="codeSnippetToolbar">
					<a title="Copy to clipboard." href="javascript:void(0)" onclick="CopyCode(this);">Copy</a>
				</div>
				
				<div class="codeSnippetCode codeVB">
					<pre xml:space="preserve" class="brush: vb">
Public Function GrabarPagos(ByVal x_usuario As String, ByVal m_tipopago As ETipos.TipoDePago, ByVal x_serie As String, _
                             ByVal x_fecha As DateTime, ByVal x_tipocambio As Decimal)
    Try
       DAEnterprise.BeginTransaction()
       Dim _i As Integer = 1
       Dim _numero As Integer = getNroTransaccion(m_pvent_id, x_serie)
       Dim _codigo As String = String.Format(&quot;{0:00}{1}{2:0000000}&quot;, m_pvent_id, x_serie, _numero)
       Dim _entid_Codigo As String = &quot;&quot;
       For Each item As EVENT_DocsVenta In m_listVENT_PagosFacturas
          Dim _caja As New BTESO_Caja
          _caja.TESO_Caja = item.TESO_Caja
          _caja.TESO_Caja.Instanciar(ACEInstancia.Nuevo)
          _caja.TESO_Caja.TIPOS_CodTipoMoneda = item.TIPOS_CodTipoMoneda
          _caja.TESO_Caja.TIPOS_CodTransaccion = ETipos.getTipoDePago(m_tipopago)
          _caja.TESO_Caja.CAJA_OrdenDocumento = _i
          _caja.TESO_Caja.CAJA_Pase = ACEVentas.Constantes.GetPase(ACEVentas.Constantes.Pase.Entrada)
          _caja.TESO_Caja.CAJA_NroDocumento = item.DOCVE_Codigo
          _caja.TESO_Caja.CAJA_Fecha = x_fecha.Date
          _caja.TESO_Caja.CAJA_Codigo = _codigo
          _caja.TESO_Caja.CAJA_Serie = x_serie
          _caja.TESO_Caja.CAJA_Numero = _numero
          _caja.TESO_Caja.TIPOS_CodTipoDocumento = item.TIPOS_CodTipoDocumento
 
          _caja.TESO_Caja.CAJA_Glosa = IIf(m_tipopago = ETipos.TipoDePago.Efectivo, ACEVentas.Constantes.getGlosaTipoDePago(ETipos.TipoDePago.Efectivo), _
                                           ACEVentas.Constantes.getGlosaTipoDePago(m_tipopago)) &amp; &quot; - &quot; &amp; String.Format(&quot;{0}-{1:00000000}&quot;, item.DOCVE_Serie, item.DOCVE_Numero)
          _caja.TESO_Caja.CAJA_Importe = item.ImportePagar
          _caja.TESO_Caja.CAJA_ImporteVenta = item.DOCVE_TotalPagar
          _caja.TESO_Caja.ENTID_Codigo = item.ENTID_CodigoCliente
          _entid_Codigo = item.ENTID_CodigoCliente
          _caja.TESO_Caja.CAJA_Estado = ETESO_Caja.getEstado(ETESO_Caja.Estado.Ingresado)
          _caja.TESO_Caja.TIPOS_CodTipoOrigen = ETipos.getTipoOrigen(ETipos.OrigenCancelacion.CFacturas)
          _caja.TESO_Caja.CAJA_TCDocumento = x_tipocambio
          _caja.TESO_Caja.CAJA_TCOficinaVenta = m_tipocambiooficina.TIPOC_VentaOficina
          _caja.TESO_Caja.CAJA_TCPorUsuario = IIf(x_tipocambio = m_tipocambiosunat.TIPOC_VentaSunat, False, True)
          _caja.TESO_Caja.CAJA_TCSunatVenta = m_tipocambiosunat.TIPOC_VentaSunat
          _caja.TESO_Caja.CAJA_TCambio = m_tipocambiooficina.TIPOC_VentaOficina
          _caja.TESO_Caja.PVENT_Id = m_pvent_id
          Dim _whereCaja As New Hashtable : _whereCaja.Add(&quot;PVENT_Id&quot;, New ACWhere(_caja.TESO_Caja.PVENT_Id))
          _caja.TESO_Caja.CAJA_Id = _caja.getCorrelativo(&quot;CAJA_Id&quot;, _whereCaja)
          _i += 1
          _caja.Guardar(x_usuario, New String() {&quot;CAJA_FechaPago&quot;})
       Next
 
       Select Case m_tipopago
          Case ETipos.TipoDePago.DepositoBancario
             Dim _bteso_docspagos As New BTESO_DocsPagos(m_pvent_id, m_periodo, m_zonas_codigo, m_sucur_id)
             Dim i As Integer = 1
             For Each item As ETESO_DocsPagos In m_listteso_docspagos
                _bteso_docspagos.TESO_DocsPagos = item
                _bteso_docspagos.TESO_DocsPagos.ENTID_Codigo = _entid_Codigo
                Dim _dpago_id As Integer = _bteso_docspagos.TESO_DocsPagos.DPAGO_Id
                If _bteso_docspagos.TESO_DocsPagos.DPAGO_Id = 0 Then
                   _bteso_docspagos.TESO_DocsPagos.PVENT_Id = m_pvent_id
                   Dim _whereCaja As New Hashtable : _whereCaja.Add(&quot;PVENT_Id&quot;, New ACWhere(_bteso_docspagos.TESO_DocsPagos.PVENT_Id))
                   _dpago_id = _bteso_docspagos.getCorrelativo(&quot;DPAGO_Id&quot;, _whereCaja)
                   _bteso_docspagos.TESO_DocsPagos.DPAGO_Id = _dpago_id
 
                   Dim _whereNroDeposito As New Hashtable
                   _whereNroDeposito.Add(&quot;DPAGO_Numero&quot;, New ACWhere(_bteso_docspagos.TESO_DocsPagos.DPAGO_Numero))
                   _whereNroDeposito.Add(&quot;CUENT_Id&quot;, New ACWhere(_bteso_docspagos.TESO_DocsPagos.CUENT_Id))
                   _whereNroDeposito.Add(&quot;BANCO_Id&quot;, New ACWhere(_bteso_docspagos.TESO_DocsPagos.BANCO_Id))
                   Dim _bteso_dp As New BTESO_DocsPagos(m_pvent_id, m_periodo, m_zonas_codigo, m_sucur_id)
                   If _bteso_dp.Cargar(_whereNroDeposito) Then
                      Throw New Exception(&quot;El Documento con el que desea cancelar ya fue ingresado, en el mismo Banco, misma cuenta, y el mismo numero, revise el numero del documento y vuelva a intentarlo&quot;)
                   End If
 
                   If _bteso_docspagos.Guardar(x_usuario) Then
                      Dim _bteso_cajadocspago As New BTESO_CajaDocsPago
                      _bteso_cajadocspago.TESO_CajaDocsPago = New ETESO_CajaDocsPago
                      _bteso_cajadocspago.TESO_CajaDocsPago.Instanciar(ACEInstancia.Nuevo)
                      _bteso_cajadocspago.TESO_CajaDocsPago.PVENT_Id = m_pvent_id
                      _bteso_cajadocspago.TESO_CajaDocsPago.CAJA_Codigo = _codigo
                      _bteso_cajadocspago.TESO_CajaDocsPago.DPAGO_Id = _dpago_id
                      _bteso_cajadocspago.TESO_CajaDocsPago.CDEPO_Importe = item.DPAGO_Importe
                      _bteso_cajadocspago.TESO_CajaDocsPago.CDEPO_Numero = i
                      _bteso_cajadocspago.Guardar(x_usuario)
                      i += 1
                   End If
                Else
                   Dim _bteso_cajadocspago As New BTESO_CajaDocsPago
                   _bteso_cajadocspago.TESO_CajaDocsPago = New ETESO_CajaDocsPago
                   _bteso_cajadocspago.TESO_CajaDocsPago.Instanciar(ACEInstancia.Nuevo)
                   _bteso_cajadocspago.TESO_CajaDocsPago.PVENT_Id = m_pvent_id
                   _bteso_cajadocspago.TESO_CajaDocsPago.CAJA_Codigo = _codigo
                   _bteso_cajadocspago.TESO_CajaDocsPago.DPAGO_Id = _dpago_id
                   _bteso_cajadocspago.TESO_CajaDocsPago.CDEPO_Importe = item.DPAGO_Importe
                   _bteso_cajadocspago.TESO_CajaDocsPago.CDEPO_Numero = i
                   _bteso_cajadocspago.Guardar(x_usuario)
                   i += 1
                End If
             Next
 
          Case ETipos.TipoDePago.Detraccion
             Dim _bteso_docspagos As New BTESO_DocsPagos(m_pvent_id, m_periodo, m_zonas_codigo, m_sucur_id)
             Dim i As Integer = 1
             For Each item As ETESO_DocsPagos In m_listteso_docspagos
                _bteso_docspagos.TESO_DocsPagos = item
                _bteso_docspagos.TESO_DocsPagos.ENTID_Codigo = _entid_Codigo
                _bteso_docspagos.TESO_DocsPagos.PVENT_Id = m_pvent_id
                Dim _dpago_id As Integer = _bteso_docspagos.TESO_DocsPagos.DPAGO_Id
                If _bteso_docspagos.TESO_DocsPagos.DPAGO_Id = 0 Then
                   Dim _whereCaja As New Hashtable : _whereCaja.Add(&quot;PVENT_Id&quot;, New ACWhere(_bteso_docspagos.TESO_DocsPagos.PVENT_Id))
                   _dpago_id = _bteso_docspagos.getCorrelativo(&quot;DPAGO_Id&quot;, _whereCaja)
                   _bteso_docspagos.TESO_DocsPagos.DPAGO_Id = _dpago_id
 
                   Dim _whereNroDeposito As New Hashtable
                   _whereNroDeposito.Add(&quot;DPAGO_Numero&quot;, New ACWhere(_bteso_docspagos.TESO_DocsPagos.DPAGO_Numero))
                   _whereNroDeposito.Add(&quot;CUENT_Id&quot;, New ACWhere(_bteso_docspagos.TESO_DocsPagos.CUENT_Id))
                   _whereNroDeposito.Add(&quot;BANCO_Id&quot;, New ACWhere(_bteso_docspagos.TESO_DocsPagos.BANCO_Id))
                   Dim _bteso_dp As New BTESO_DocsPagos(m_pvent_id, m_periodo, m_zonas_codigo, m_sucur_id)
                   If _bteso_dp.Cargar(_whereNroDeposito) Then
                      Throw New Exception(&quot;El Documento con el que desea cancelar ya fue ingresado, en el mismo Banco, misma cuenta, y el mismo numero, revise el numero del documento y vuelva a intentarlo&quot;)
                   End If
 
                   If _bteso_docspagos.Guardar(x_usuario) Then
                      Dim _bteso_cajadocspago As New BTESO_CajaDocsPago
                      _bteso_cajadocspago.TESO_CajaDocsPago = New ETESO_CajaDocsPago
                      _bteso_cajadocspago.TESO_CajaDocsPago.Instanciar(ACEInstancia.Nuevo)
                      _bteso_cajadocspago.TESO_CajaDocsPago.PVENT_Id = m_pvent_id
                      _bteso_cajadocspago.TESO_CajaDocsPago.CAJA_Codigo = _codigo
                      _bteso_cajadocspago.TESO_CajaDocsPago.DPAGO_Id = _dpago_id
                      _bteso_cajadocspago.TESO_CajaDocsPago.CDEPO_Importe = item.ImporteUsado
                      _bteso_cajadocspago.TESO_CajaDocsPago.CDEPO_Numero = i
                      '_bteso_cajadocspago.TESO_CajaDocsPago.CAJA_Id = item.
                      _bteso_cajadocspago.Guardar(x_usuario)
                      i += 1
                   End If
                Else
                   Dim _bteso_cajadocspago As New BTESO_CajaDocsPago
                   _bteso_cajadocspago.TESO_CajaDocsPago = New ETESO_CajaDocsPago
                   _bteso_cajadocspago.TESO_CajaDocsPago.Instanciar(ACEInstancia.Nuevo)
                   _bteso_cajadocspago.TESO_CajaDocsPago.PVENT_Id = m_pvent_id
                   _bteso_cajadocspago.TESO_CajaDocsPago.CAJA_Codigo = _codigo
                   _bteso_cajadocspago.TESO_CajaDocsPago.DPAGO_Id = _dpago_id
                   _bteso_cajadocspago.TESO_CajaDocsPago.CDEPO_Importe = item.DPAGO_Importe
                   _bteso_cajadocspago.TESO_CajaDocsPago.CDEPO_Numero = i
                   '_bteso_cajadocspago.TESO_CajaDocsPago.CAJA_Id = item.
                   _bteso_cajadocspago.Guardar(x_usuario)
                   i += 1
                End If
 
             Next
          Case ETipos.TipoDePago.NotaCredito
             '' Grabar Documentos que Pagan
             Dim _bteso_docspagos As New BTESO_DocsPagos(m_pvent_id, m_periodo, m_zonas_codigo, m_sucur_id)
             Dim i As Integer = 1
             For Each item As ETESO_DocsPagos In m_listteso_docspagos
                _bteso_docspagos.TESO_DocsPagos = item
                _bteso_docspagos.TESO_DocsPagos.ENTID_Codigo = _entid_Codigo
                _bteso_docspagos.TESO_DocsPagos.DPAGO_Numero = String.Format(&quot;NC {0}-{1:0000000}&quot;, _bteso_docspagos.TESO_DocsPagos.VENT_DocsVenta.DOCVE_Serie, _bteso_docspagos.TESO_DocsPagos.VENT_DocsVenta.DOCVE_Numero)
                _bteso_docspagos.TESO_DocsPagos.PVENT_Id = m_pvent_id
                Dim _whereCaja As New Hashtable : _whereCaja.Add(&quot;PVENT_Id&quot;, New ACWhere(_bteso_docspagos.TESO_DocsPagos.PVENT_Id))
                _bteso_docspagos.TESO_DocsPagos.DPAGO_Id = _bteso_docspagos.getCorrelativo(&quot;DPAGO_Id&quot;, _whereCaja)
                If _bteso_docspagos.Guardar(x_usuario) Then
                   Dim _bteso_cajadocspago As New BTESO_CajaDocsPago
                   _bteso_cajadocspago.TESO_CajaDocsPago = New ETESO_CajaDocsPago
                   _bteso_cajadocspago.TESO_CajaDocsPago.Instanciar(ACEInstancia.Nuevo)
                   _bteso_cajadocspago.TESO_CajaDocsPago.PVENT_Id = m_pvent_id
                   _bteso_cajadocspago.TESO_CajaDocsPago.CAJA_Codigo = _codigo
                   _bteso_cajadocspago.TESO_CajaDocsPago.DPAGO_Id = _bteso_docspagos.TESO_DocsPagos.DPAGO_Id
                   _bteso_cajadocspago.TESO_CajaDocsPago.CDEPO_Importe = item.ImporteUsado
                   _bteso_cajadocspago.TESO_CajaDocsPago.CDEPO_Numero = i
                   _bteso_cajadocspago.Guardar(x_usuario)
                   i += 1
                End If
                '' Grabar Nota de Credito
                _bteso_docspagos.TESO_DocsPagos.VENT_DocsVenta.ENTID_CodigoCliente = _entid_Codigo
                Dim m_bgenerardocsventa As New BGenerarDocsVenta(m_pvent_id, m_periodo, m_zonas_codigo, m_sucur_id)
                Dim x_msg As String = &quot;&quot;
                m_bgenerardocsventa.VENT_DocsVenta = _bteso_docspagos.TESO_DocsPagos.VENT_DocsVenta
                m_bgenerardocsventa.VENT_DocsVenta.Instanciar(ACEInstancia.Nuevo)
                m_bgenerardocsventa.VENT_DocsVenta.DOCVE_Estado = EVENT_DocsVenta.getEstado(EVENT_DocsVenta.Estado.Ingresado)
                m_bgenerardocsventa.VENT_DocsVenta.ListVENT_DocsVentaDetalle = New List(Of EVENT_DocsVentaDetalle)
                Dim _detalle As New EVENT_DocsVentaDetalle
                _detalle.DOCVD_PrecioUnitario = m_bgenerardocsventa.VENT_DocsVenta.DOCVE_ImporteVenta
                _detalle.DOCVD_SubImporteVenta = m_bgenerardocsventa.VENT_DocsVenta.DOCVE_ImporteVenta
                _detalle.DOCVD_Cantidad = 1
                m_bgenerardocsventa.VENT_DocsVenta.ListVENT_DocsVentaDetalle.Add(_detalle)
                If Not m_bgenerardocsventa.generarDocumento(x_usuario, m_bgenerardocsventa.VENT_DocsVenta.DOCVE_FechaDocumento, _
                                                        m_bgenerardocsventa.VENT_DocsVenta.DOCVE_Serie, _
                                                        m_bgenerardocsventa.VENT_DocsVenta.DOCVE_Numero, &quot;E&quot;, x_msg, False) Then
                   Throw New Exception(&quot;No Se puede Generar el Documento Nota de Credito&quot;)
                End If
             Next
          Case ETipos.TipoDePago.RecEgreInterno
             Dim _bteso_docspagos As New BTESO_DocsPagos(m_pvent_id, m_periodo, m_zonas_codigo, m_sucur_id)
             Dim i As Integer = 1
             For Each item As ETESO_DocsPagos In m_listteso_docspagos
                _bteso_docspagos.TESO_DocsPagos = item
                _bteso_docspagos.TESO_DocsPagos.ENTID_Codigo = _entid_Codigo
                _bteso_docspagos.TESO_DocsPagos.PVENT_Id = m_pvent_id
                Dim _whereCaja As New Hashtable : _whereCaja.Add(&quot;PVENT_Id&quot;, New ACWhere(_bteso_docspagos.TESO_DocsPagos.PVENT_Id))
                _bteso_docspagos.TESO_DocsPagos.DPAGO_Id = _bteso_docspagos.getCorrelativo(&quot;DPAGO_Id&quot;, _whereCaja)
                If _bteso_docspagos.Guardar(x_usuario) Then
                   Dim _bteso_cajadocspago As New BTESO_CajaDocsPago
                   _bteso_cajadocspago.TESO_CajaDocsPago = New ETESO_CajaDocsPago
                   _bteso_cajadocspago.TESO_CajaDocsPago.Instanciar(ACEInstancia.Nuevo)
                   _bteso_cajadocspago.TESO_CajaDocsPago.CAJA_Codigo = _codigo
                   _bteso_cajadocspago.TESO_CajaDocsPago.DPAGO_Id = _bteso_docspagos.TESO_DocsPagos.DPAGO_Id
                   _bteso_cajadocspago.TESO_CajaDocsPago.CDEPO_Importe = item.ImporteUsado
                   _bteso_cajadocspago.TESO_CajaDocsPago.PVENT_Id = m_pvent_id
                   _bteso_cajadocspago.TESO_CajaDocsPago.CDEPO_Numero = i
                   _bteso_cajadocspago.Guardar(x_usuario)
                   i += 1
                End If
             Next
       End Select
       DAEnterprise.CommitTransaction()
       Return True
    Catch ex As Exception
       DAEnterprise.RollBackTransaction()
       Throw ex
    End Try
 End Function
					</pre>			
				</div>
				<div class="codeSnippetCode codeNA">
					<pre xml:space="preserve">Este idioma no es compatible o no hay ningún ejemplo de código disponible.</pre>			
				</div>
			</div>
		</div>

	</div>					
</div>



<div class="section_container">
	<div class="section_heading">
		<span><a href="javascript:void(0)" title="Collapse" onclick="toggleSection(this);">Plataformas</a></span>
		<div><hr /></div>
	</div>

	<div id="platformsSection" class="section">	
		<p>
			Windows 8, Windows Server 2012, Windows 7, Windows Vista SP1 or later, Windows XP SP3, Windows XP SP2 x64 Edition, Windows Server 2008 (Server Core not supported), Windows Server 2008 R2 (Server Core supported with SP1 or later), Windows Server 2003 SP2
		</p>
		<p>
			.NET Framework no admite todas las versiones de cada plataforma. Para obtener una lista de las versiones admitidas, vea 
			<a target="_top" href="http://msdn2.microsoft.com/en-us/library/298275e2-da1d-4618-9f74-6a3567832350.aspx">System Requirements</a>.
		</p>
	</div>					
</div>



  

	

	
	

<div class="section_container">
	<div class="section_heading">
		<span><a href="javascript:void(0)" title="Collapse" onclick="toggleSection(this);">Información de versión</a></span>
		<div><hr /></div>
	</div>

	<div id="frameworksSection" class="section">	
  <h4 class="subHeading">.NET Framework</h4>Supported in: 4.5, 4, 3.5, 3.0, 2.0, 1.1, 1.0<br />

	<h4 class="subHeading">.NET Compact Framework</h4>Supported in: 3.5, 2.0, 1.0<br />

	<h4 class="subHeading">XNA Framework</h4>Supported in: 3.0, 2.0, 1.0<br />
	
	</div>					
</div>

<div class="section_container">
	<div class="section_heading">
		<span><a href="javascript:void(0)" title="Collapse" onclick="toggleSection(this);">Vea también</a></span>
		<div><hr /></div>
	</div>

	<div id="seeAlsoSection" class="section">	
		<div>
			<h4 class="subHeading">
				Referencia</h4>
			<a href="topic_000000000000073B.html">BGCancelacion (Clase)</a><br />
<a href="topic_000000000000073B_members--.html">BGCancelacion (Miembros)</a><br />




			

		</div>
	</div>					
</div>
			</div>
			</div>
      <div id="footer">
      	<p><span style="color: #FF0000;">Generated with unregistered version of <a target="_top" href="http://www.helixoft.com/vsdocman/overview.html">VSdocman</a></span>&nbsp;<br />Your own footer text will only be shown in registered version.</p>
      </div>
    </div>
  	<script type="text/javascript">
<!--
	try {
		parent.frames["vbdocswitch"].expandLinkInToc(location.href);
	} catch (ex) {}
//-->
		</script>	
  </body>
</html>

